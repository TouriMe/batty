!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";e.FE.PLUGINS.lists=function(t){function n(e){return'<span class="fr-open-'+e.toLowerCase()+'"></span>'}function a(e){return'<span class="fr-close-'+e.toLowerCase()+'"></span>'}function r(t,n){for(var a=[],r=0;r<t.length;r++){var o=t[r].parentNode;"LI"==t[r].tagName&&o.tagName!=n&&a.indexOf(o)<0&&a.push(o)}for(r=a.length-1;r>=0;r--){var i=e(a[r]);i.replaceWith("<"+n.toLowerCase()+">"+i.html()+"</"+n.toLowerCase()+">")}}function o(n,a){r(n,a);for(var o=t.html.defaultTag(),i=0;i<n.length;i++)"LI"!=n[i].tagName&&(o&&n[i].tagName.toLowerCase()==o?e(n[i]).replaceWith("<"+a+"><li"+t.node.attributes(n[i])+">"+e(n[i]).html()+"</li></"+a+">"):e(n[i]).wrap("<"+a+"><li></li></"+a+">"));t.clean.lists()}function i(r){var o,i;for(o=r.length-1;o>=0;o--)for(i=o-1;i>=0;i--)if(e(r[i]).find(r[o]).length||r[i]==r[o]){r.splice(o,1);break}var s=[];for(o=0;o<r.length;o++){var l=e(r[o]),f=r[o].parentNode;l.before(a(f.tagName)),"LI"==f.parentNode.tagName?(l.before(a("LI")),l.after(n("LI"))):(t.node.isEmpty(l.get(0),!0)||0!==l.find(t.html.blockTagsQuery()).length||l.append("<br>"),l.append(n("LI")),l.prepend(a("LI"))),l.after(n(f.tagName)),"LI"==f.parentNode.tagName&&(f=f.parentNode.parentNode),s.indexOf(f)<0&&s.push(f)}for(o=0;o<s.length;o++){var p=e(s[o]),c=p.html();c=c.replace(/<span class="fr-close-([a-z]*)"><\/span>/g,"</$1>"),c=c.replace(/<span class="fr-open-([a-z]*)"><\/span>/g,"<$1>"),p.replaceWith(t.node.openTagString(p.get(0))+c+t.node.closeTagString(p.get(0)))}t.$el.find("li:empty").remove(),t.$el.find("ul:empty, ol:empty").remove(),t.clean.lists(),t.html.wrap()}function s(e,t){for(var n=!0,a=0;a<e.length;a++){if("LI"!=e[a].tagName)return!1;e[a].parentNode.tagName!=t&&(n=!1)}return n}function l(e){t.selection.save(),t.html.wrap(!0,!0,!0,!0),t.selection.restore();for(var n=t.selection.blocks(),a=0;a<n.length;a++)"LI"!=n[a].tagName&&"LI"==n[a].parentNode.tagName&&(n[a]=n[a].parentNode);t.selection.save(),s(n,e)?i(n):o(n,e),t.html.unwrap(),t.selection.restore()}function f(n,a){var r=e(t.selection.element());if(r.get(0)!=t.$el.get(0)){var o=r.get(0);"LI"!=o.tagName&&(o=r.parents("li").get(0)),o&&o.parentNode.tagName==a&&t.$el.get(0).contains(o.parentNode)&&n.addClass("fr-active")}}function p(n){t.selection.save();for(var a=0;a<n.length;a++){var r=n[a].previousSibling;if(r){var o=e(n[a]).find("> ul, > ol").get(0);if(o){for(var i=e("<li>").prependTo(e(o)),s=t.node.contents(n[a])[0];s&&!t.node.isList(s);){var l=s.nextSibling;i.append(s),s=l}e(r).append(e(o)),e(n[a]).remove()}else{var f=e(r).find("> ul, > ol").get(0);if(f)e(f).append(e(n[a]));else{var p=e("<"+n[a].parentNode.tagName+">");e(r).append(p),p.append(e(n[a]))}}}}t.clean.lists(),t.selection.restore()}function c(e){t.selection.save(),i(e),t.selection.restore()}function d(e){if("indent"==e||"outdent"==e){for(var n=!1,a=t.selection.blocks(),r=[],o=0;o<a.length;o++)"LI"==a[o].tagName?(n=!0,r.push(a[o])):"LI"==a[o].parentNode.tagName&&(n=!0,r.push(a[o].parentNode));n&&("indent"==e?p(r):c(r))}}function u(){t.events.on("commands.after",d),t.events.on("keydown",function(n){if(n.which==e.FE.KEYCODE.TAB){for(var a,r=t.selection.blocks(),o=[],i=0;i<r.length;i++)"LI"==r[i].tagName?(a=!0,o.push(r[i])):"LI"==r[i].parentNode.tagName&&(a=!0,o.push(r[i].parentNode));if(a)return n.preventDefault(),n.stopPropagation(),n.shiftKey?c(o):p(o),!1}},!0)}return{_init:u,format:l,refresh:f}},e.FE.RegisterCommand("formatUL",{title:"Unordered List",refresh:function(e){this.lists.refresh(e,"UL")},callback:function(){this.lists.format("UL")},plugin:"lists"}),e.FE.RegisterCommand("formatOL",{title:"Ordered List",refresh:function(e){this.lists.refresh(e,"OL")},callback:function(){this.lists.format("OL")},plugin:"lists"}),e.FE.DefineIcon("formatUL",{NAME:"list-ul"}),e.FE.DefineIcon("formatOL",{NAME:"list-ol"})});